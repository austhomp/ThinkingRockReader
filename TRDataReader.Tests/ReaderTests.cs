using System;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using System.Linq;

namespace TRDataReader.Tests
{
    [TestClass]
    public class ReaderTests
    {
        private const string TestInput = @"<data><version>5</version><maxID>149</maxID><topics><items><topic><name>None</name><description>No topic.</description><color><red>0</red><green>0</green><blue>0</blue><alpha>255</alpha></color><background><red>255</red><green>255</green><blue>255</blue><alpha>255</alpha></background><id>8</id></topic></items></topics><contexts><items><context><name>None</name><description>No context.</description><id>9</id></context><context><name>@ContextOne</name><description></description><id>144</id></context><context><name>@Context2</name><description></description><id>145</id></context></items></contexts><information><items><info><created>2014-02-08 20:05:02.631 UTC</created><description>Action 3 (Reference)</description><topic reference=""../../../../topics/items/topic""/><location></location><notes>Test</notes><id>140</id></info></items></information><futures><items><future><created>2014-02-08 20:05:11.727 UTC</created><thought><created>2014-02-08 20:04:06.63 UTC</created><description>Action 4 (Someday)</description><topic reference=""../../../../../topics/items/topic""/><processed>true</processed><id>132</id></thought><description>Action 4 (Someday)</description><topic reference=""../../../../topics/items/topic""/><notes></notes><id>142</id></future></items></futures><thoughts><items><thought><created>2014-02-08 20:03:44.3 UTC</created><description>Action 1</description><topic reference=""../../../../topics/items/topic""/><processed>true</processed><id>128</id></thought><thought><created>2014-02-08 20:03:50.606 UTC</created><description>Action 2</description><topic reference=""../../../../topics/items/topic""/><processed>true</processed><id>129</id></thought><thought><created>2014-02-08 20:03:53.15 UTC</created><description>Action 3 (Reference)</description><topic reference=""../../../../topics/items/topic""/><processed>true</processed><notes>Test</notes><id>130</id></thought><thought reference=""../../../futures/items/future/thought""/><thought><created>2014-02-08 20:04:08.662 UTC</created><description>Action 5</description><topic reference=""../../../../topics/items/topic""/><processed>false</processed><id>133</id></thought><thought><created>2014-02-08 20:04:10.22 UTC</created><description>Action 6</description><topic reference=""../../../../topics/items/topic""/><processed>false</processed><id>134</id></thought></items></thoughts><rootProject class=""projects""><id>1</id><created>2014-02-08 20:03:38.744 UTC</created><parent class=""tr.model.project.ProjectRoot""><id>0</id><created>2014-02-08 20:03:38.785 UTC</created><children><projects reference=""../../..""/><actions><id>2</id><created>2014-02-08 20:03:38.745 UTC</created><parent class=""tr.model.project.ProjectRoot"" reference=""../../..""/><children><action><id>137</id><created>2014-02-08 20:04:14.848 UTC</created><thought reference=""../../../../../../../thoughts/items/thought""/><parent class=""actions"" reference=""../../..""/><description>Action 1</description><topic reference=""../../../../../../../topics/items/topic""/><context reference=""../../../../../../../contexts/items/context[2]""/><state class=""actionStateASAP""><created>2014-02-08 20:04:34.54 UTC</created></state><notes></notes><done>false</done><priority><id>126</id><name>Would</name></priority><success></success><modified>2014-02-08 20:06:28.895 UTC</modified></action><action><id>138</id><created>2014-02-08 20:04:34.54 UTC</created><thought reference=""../../../../../../../thoughts/items/thought[2]""/><parent class=""actions"" reference=""../../..""/><description>Action 2</description><topic reference=""../../../../../../../topics/items/topic""/><context reference=""../../../../../../../contexts/items/context""/><state class=""actionStateInactive""><created>2014-02-08 20:04:40.271 UTC</created></state><notes></notes><done>false</done><priority><id>127</id><name>Could</name></priority><success></success><modified>2014-02-08 20:06:32.935 UTC</modified></action><action><id>147</id><created>2014-02-08 20:06:38.255 UTC</created><parent class=""actions"" reference=""../../..""/><description>Another action</description><topic reference=""../../../../../../../topics/items/topic""/><context reference=""../../../../../../../contexts/items/context[3]""/><state class=""actionStateInactive""><created>2014-02-08 20:06:38.257 UTC</created></state><notes>Manually entered into single actions via F3 and not from process screen</notes><done>false</done><priority><id>125</id><name>Should</name></priority><modified>2014-02-08 20:07:15.831 UTC</modified></action></children><topic reference=""../../../../../topics/items/topic""/><description></description><purpose></purpose><success></success><brainstorming></brainstorming><organising></organising><done>false</done><sequence>true</sequence><modified>2014-02-08 20:06:38.257 UTC</modified></actions></children><topic reference=""../../../topics/items/topic""/><description></description><purpose></purpose><success></success><brainstorming></brainstorming><organising></organising><done>false</done><sequence>true</sequence><modified>2014-02-08 20:03:38.785 UTC</modified></parent><children><project><id>148</id><created>2014-02-08 20:07:22.920 UTC</created><parent class=""projects"" reference=""../../..""/><children><action><id>149</id><created>2014-02-08 20:07:30.154 UTC</created><parent reference=""../../..""/><description>Project action 1</description><topic reference=""../../../../../../topics/items/topic""/><context reference=""../../../../../../contexts/items/context[3]""/><state class=""actionStateASAP""><created>2014-02-08 20:07:45.880 UTC</created></state><notes></notes><done>false</done><modified>2014-02-08 20:07:45.880 UTC</modified></action></children><topic reference=""../../../../topics/items/topic""/><description>Test project</description><purpose></purpose><success></success><brainstorming></brainstorming><organising></organising><done>false</done><sequence>true</sequence><modified>2014-02-08 20:07:30.154 UTC</modified><seqIncludeProjects>true</seqIncludeProjects><seqIncludeScheduled>false</seqIncludeScheduled><seqIncludeDelegated>false</seqIncludeDelegated></project></children><topic reference=""../../topics/items/topic""/><description></description><purpose></purpose><success></success><brainstorming></brainstorming><organising></organising><done>false</done><sequence>true</sequence><modified>2014-02-08 20:07:22.920 UTC</modified></rootProject><rootActions class=""actions"" reference=""../rootProject/parent/children/actions""/><rootTemplates class=""tr.model.project.ProjectTemplates""><id>3</id><created>2014-02-08 20:03:38.745 UTC</created><children/><topic reference=""../../topics/items/topic""/><description></description><purpose></purpose><success></success><brainstorming></brainstorming><organising></organising><done>false</done><sequence>true</sequence><modified>2014-02-08 20:03:38.745 UTC</modified></rootTemplates><rootFutures class=""tr.model.project.ProjectFutures""><id>4</id><created>2014-02-08 20:03:38.745 UTC</created><children/><topic reference=""../../topics/items/topic""/><description></description><purpose></purpose><success></success><brainstorming></brainstorming><organising></organising><done>false</done><sequence>true</sequence><modified>2014-02-08 20:03:38.745 UTC</modified></rootFutures><timeCriterion><name>Time</name><use>false</use><values><items><value><id>101</id><name>5 min</name></value><value><id>102</id><name>10 min</name></value><value><id>103</id><name>15 min</name></value><value><id>104</id><name>20 min</name></value><value><id>105</id><name>30 min</name></value><value><id>106</id><name>45 min</name></value><value><id>107</id><name>1 hr</name></value><value><id>108</id><name>1.5 hrs</name></value><value><id>109</id><name>2 hrs</name></value><value><id>110</id><name>2.5 hrs</name></value><value><id>111</id><name>3 hrs</name></value><value><id>112</id><name>4 hrs</name></value><value><id>113</id><name>5 hrs</name></value><value><id>114</id><name>6 hrs</name></value><value><id>115</id><name>7 hrs</name></value><value><id>116</id><name>8 hrs</name></value></items></values></timeCriterion><energyCriterion><name>Energy</name><use>false</use><values><items><value><id>117</id><name>None</name></value><value><id>118</id><name>Low Mental</name></value><value><id>119</id><name>Med Mental</name></value><value><id>120</id><name>High Mental</name></value><value><id>121</id><name>Low Physical</name></value><value><id>122</id><name>Med Physical</name></value><value><id>123</id><name>High Physical</name></value></items></values></energyCriterion><priorityCriterion><name>Priority</name><use>true</use><values><items><value><id>124</id><name>Must</name></value><value reference=""../../../../rootProject/parent/children/actions/children/action[3]/priority""/><value reference=""../../../../rootProject/parent/children/actions/children/action/priority""/><value reference=""../../../../rootProject/parent/children/actions/children/action[2]/priority""/></items></values></priorityCriterion><maxLogID>0</maxLogID><actors><items/></actors><levels/></data>";

        [TestMethod]
        public void ParseData_Should_ReturnCorrectEntriesForTheInput()
        {
            var reader = new Reader();
            var output = reader.ParseData(TestInput);

            Assert.IsNotNull(output);

            var doasap = output.Where(x => x.ActionState.Contains("ASAP")).ToList();
            Assert.IsTrue(doasap.Count == 2);

            var inactives = output.Where(x => x.ActionState.Contains("Inactive")).ToList();
            Assert.IsTrue(inactives.Count == 2);
        }
    }
}
